from rich import print
import nmap
import requests
import socket
import json


#############################
#                           #
#         Start Scan        #
#                           #
#############################

def Start(website):
    global data 
    global header
    data = []
    header = []
    target = website
    ports = [21, 22, 80, 139, 443, 8080]
    headerBool = True

    





#############################
#                           #
#      Header request       #
#                           #
#############################

    if headerBool:
        data.append(f"===== SCAN OF {website} =====")
        data.append(f"\nRequest Header: \n")
        request = print(requests.get("https://" + website))
        header.append(f"\n{str(request.headers)}\n")
        headerBool = False






#############################
#                           #
#    IP & Port scanning     #
#                           #
#############################

    data.append(f"Host IP:")
    host_ip = socket.gethostbyname(website)
    data.append(f"\nHet ip-adres van {website} is: {host_ip}\n")
    data.append(f"Port scan:")
    scan_v = nmap.PortScanner()
    data.append(f"\nScannen van {target}\n")
    
    for port in ports:
        portscan = scan_v.scan(target, str(port))
        dataPort = f"Poort: {port} is " + portscan["scan"][list(portscan["scan"])[0]]["tcp"][port]["state"]
        data.append(dataPort)
    
    dataServer = f"Host: {target} is " + portscan["scan"][list(portscan["scan"])[0]]["status"]["state"]   
    data.append(dataServer)






#############################
#                           #
#  Geolocation from host    #
#                           #
#############################

    
    data.append(f"\nHost gegevens:\n")

    request_twee = requests.get("https://ipinfo.io/" + host_ip + "/json")
    response = json.loads(request_twee.text)

    data.append("Locatie: " + response["loc"])
    data.append("Regie: " + response["region"])
    data.append("Stad: " + response["city"])
    data.append("Land: " + response["country"])




#############################
#                           #
#       Return data         #
#                           #
#############################
    
def getData():
    return data
def getHeader():
    return header
