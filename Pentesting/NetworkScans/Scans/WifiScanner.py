import subprocess
import re
import platform
import os

def scan_wifi(output_file='wifi_scan_output.txt'):
    try:
        if platform.system() == 'Darwin':
            result = subprocess.run(['/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport', '-s'], capture_output=True, text=True, check=True)
        elif platform.system() == 'Windows':
            result = result = subprocess.run(['iwlist', 'wlan0', 'scan'], capture_output=True, text=True, check=True)
        elif platform.system() == 'Linux':
            pass
        else:
            print("System not supported")
        
        networks = parse_wifi_scan(result.stdout)
        with open(output_file, 'w') as file:
            file.write("Available WiFi Networks:\n")
            for network in networks:
                file.write(str(network) + '\n')

        print(f"WiFi scan results saved to {output_file}")
        os.system(f"mv {output_file} Pentesting/NetworkScans/Output")

    except subprocess.CalledProcessError as e:
        print(f"Error: {e}")
    except Exception as e:
        print(f"An error occurred: {e}")

def parse_wifi_scan(output):
    networks = []
    lines = output.split('\n')

    # Skip the header line
    for line in lines[1:]:
        fields = line.split()

        # Extract relevant information
        if len(fields) >= 7:
            network = {
                'SSID': fields[0],
                'BSSID': fields[1],
                'RSSI': fields[2],
                'Channel': fields[3],
                'HT': fields[4],
                'CC': fields[5],
                'Security': fields[6]
            }
            networks.append(network)

    return networks

if __name__ == "__main__":
    scan_wifi()
