import os
import platform
import nmcli
import json
import Pentesting.ModuleTools as Module

txt_file = "Output/Wifi.txt"
json_file = "Output/Wifi.json"

wifi_networks = {}

#############################
#                           #
#  Get AP for Linux, Macos  #
#                           #
#############################

def getWifi_Linux():
    global connections
    connections = nmcli.device.wifi()

    for connection in connections:
        ssid = connection.ssid
        wifi_networks[ssid] = {

            "MODE": connection.mode,
            "CHAN": connection.chan,
            "RATE": connection.rate,
            "SIGNAL": connection.signal,
            "SECURITY": connection.security,
            "BSSID": connection.bssid,
        }
    with open(json_file, "w") as file:
        json.dump(wifi_networks, file, indent=4)

def getWifi_Macos():
    
    result = os.popen('sudo airport en1 -s').read()
    with open(txt_file, "w") as file:
        file.write(str(result))

def StartScan():
    Module.clean()
    Module.line()
    print(f"\nWifi Scan will begin\n")
    Module.line()
    
    if platform.system() == "Darwin":
        getWifi_Macos()

    elif platform.system() == "Windows":
        print("We dont support Windows!")

    elif platform.system() == "Linux":
        getWifi_Linux()


